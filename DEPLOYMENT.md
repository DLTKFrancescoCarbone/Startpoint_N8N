# Startpoint N8N Node - Railway Deployment Guide

## Overview

This guide covers deploying the Startpoint N8N node to Railway in the same workspace as your N8N instance, creating a custom N8N image with the Startpoint node pre-installed.

## Deployment Strategy

### Recommended Approach: Custom N8N Image
Instead of deploying the node as a separate service, we create a custom N8N Docker image that includes the Startpoint node. This approach:
- ✅ Ensures node is always available when N8N starts
- ✅ Simplifies deployment (single service instead of two)
- ✅ Reduces complexity and potential connectivity issues
- ✅ Follows N8N community best practices

## Prerequisites

1. **Built Node**: Ensure `npm run build` has been executed
2. **Railway Account**: Access to the same workspace as your N8N deployment
3. **Git Repository**: Code committed to GitHub

## Deployment Steps

### 1. Pre-Deployment Build
```bash
npm run build
```
This creates the `dist/` folder with compiled node files that Docker needs.

### 2. Railway Deployment Options

#### Option A: Direct Repository Deployment (Recommended)
1. Create a new Railway service in your N8N workspace
2. Connect this GitHub repository
3. Railway will automatically:
   - Detect the Dockerfile
   - Build the custom N8N image
   - Deploy with the Startpoint node included

#### Option B: Docker Image Deployment
```bash
# Build locally and test
npm run docker:build
npm run docker:run

# Deploy to Railway using their CLI
railway deploy
```

### 3. Railway Configuration

Add these environment variables to your Railway service:
```
N8N_CUSTOM_EXTENSIONS=/home/node/.n8n/custom
```

## File Structure Analysis

### Current Optimized Structure ✅
```
/
├── Dockerfile              # Custom N8N image definition
├── .dockerignore           # Optimized build exclusions
├── package.json            # Node package configuration
├── dist/                   # Compiled node files (generated by npm run build)
│   ├── credentials/
│   │   └── StartpointApi.credentials.js
│   └── nodes/
│       └── Startpoint/
│           └── Startpoint.node.js
├── credentials/            # Source TypeScript files
├── nodes/                  # Source TypeScript files
└── index.js               # Entry point
```

## Dockerfile Improvements Made

### Compared to Template Dockerfile:
1. **Simplified Structure**: No nested subdirectories since node is at root
2. **Security Enhanced**: Proper user switching (root → node)
3. **Build Cache Optimized**: Copy package.json first for better caching
4. **Production Ready**: Only installs production dependencies
5. **Proper Permissions**: Sets correct file ownership

### Key Improvements:
- **Layer Optimization**: Separate package.json copy for better Docker caching
- **Security**: Switch back to `node` user after installation
- **Size Optimization**: `.dockerignore` excludes unnecessary files
- **Railway Compatible**: Works with Railway's auto-detection

## Testing

### Local Testing
```bash
# Build and test the Docker image locally
npm run docker:build
npm run docker:run

# Access N8N at http://localhost:5678
# Verify Startpoint node appears in node palette
```

### Verification Checklist
- [ ] N8N starts without errors
- [ ] Startpoint node appears in node palette
- [ ] All 6 resources are available (Project, Client, Employee, Phase, Task, Discipline)
- [ ] Authentication works with Startpoint API credentials
- [ ] CRUD operations function correctly

## Railway-Specific Considerations

### Environment Variables
```bash
# Railway will automatically set these:
PORT=5678                   # N8N web interface port
N8N_HOST=0.0.0.0           # Allow external connections

# You may want to add:
N8N_SECURE_COOKIE=false    # For Railway's proxy setup
```

### Service Configuration
- **Port**: Railway will automatically map to N8N's default port 5678
- **Scaling**: Single instance recommended for N8N
- **Persistence**: Configure volume mounts if you need workflow persistence

## Troubleshooting

### Common Issues:

1. **Node Not Appearing**
   - Verify `dist/` folder exists and contains compiled files
   - Check Railway build logs for compilation errors
   - Ensure package.json n8n configuration is correct

2. **Permission Errors**
   - Dockerfile handles user switching correctly
   - Railway runs containers with appropriate permissions

3. **Build Failures**
   - Run `npm run build` locally first
   - Check for TypeScript compilation errors
   - Verify all dependencies are in package.json

### Debugging Commands:
```bash
# Check if node files exist in container
docker exec -it <container> ls -la /home/node/.n8n/custom/dist

# Check N8N logs
docker logs <container> --follow
```

## Alternative Deployment (Not Recommended)

If you prefer the original template approach with subdirectories:
1. Create `n8n-nodes-startpoint/` subfolder
2. Move all node files into subfolder
3. Update Dockerfile paths accordingly
4. This adds complexity without benefits

## Next Steps After Deployment

1. **Configure Startpoint API Credentials** in N8N interface
2. **Test Workflows** using Startpoint operations
3. **Monitor Performance** and adjust Railway resources if needed
4. **Set up Backup Strategy** for N8N workflows and data